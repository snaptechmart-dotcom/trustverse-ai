generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id    String @id @default(auto()) @map("_id") @db.ObjectId
  email String @unique
  password String

  // ðŸŽ¯ CREDITS
  credits Int @default(10)

  // ðŸ’³ PLAN & SUBSCRIPTION
  plan               String  @default("free")
  billing            String?
  subscriptionStatus String  @default("INACTIVE") // ACTIVE | CANCELED | PAST_DUE
  paddleCustomerId   String?

  planExpiresAt DateTime?
  createdAt DateTime @default(now())

  payments  Payment[]
  histories History[]
}

model Payment {
  id     String @id @default(auto()) @map("_id") @db.ObjectId
  userId String @db.ObjectId

  plan     String
  billing  String
  amount   Float
  currency String

  gateway String // razorpay | paddle

  // Razorpay
  razorpayPaymentId String?
  razorpayOrderId   String?

  // Paddle
  paddleTransactionId  String?
  paddleSubscriptionId String?

  status String // success | failed | pending
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id])
}

model Plan {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  name    String
  slug    String @unique
  billing String // monthly | yearly
  credits Int

  paddleProductId String? @unique

  createdAt DateTime @default(now())
}

model History {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  userId      String   @db.ObjectId
  tool        String
  input       Json
  inputKey    String?
  summary     Json?
  result      Json
  creditsUsed Int?
  createdAt   DateTime @default(now())

  user User @relation(fields: [userId], references: [id])
}
