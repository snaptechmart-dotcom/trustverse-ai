generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id    String @id @default(auto()) @map("_id") @db.ObjectId
  email String @unique

  // ğŸ” AUTH
  password String

  // ğŸ¯ CREDITS
  credits Int @default(10)

  // ğŸ’³ PLAN
  plan          String    @default("free")
  billing       String?
  planExpiresAt DateTime?

  createdAt DateTime @default(now())

  // ğŸ”— RELATIONS
  payments  Payment[]
  histories History[]
}

model Payment {
  id     String @id @default(auto()) @map("_id") @db.ObjectId
  userId String @db.ObjectId

  plan     String
  billing  String
  amount   Float
  currency String

  razorpayPaymentId String @unique
  razorpayOrderId   String
  status            String

  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id])
}

model History {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  userId      String   @db.ObjectId
  tool        String
  input       Json
  inputKey    String?
  summary     Json?
  result      Json
  creditsUsed Int?
  createdAt   DateTime @default(now())

  // âœ… REQUIRED OPPOSITE RELATION (SAFE)
  user User @relation(fields: [userId], references: [id])
}
